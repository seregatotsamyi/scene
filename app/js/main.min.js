import{animation,animationReviews,animationEnd}from"./anim.js";window.onload=function(){"use strict";animation();let n={phone:!1,rating:!1,ratingOld:!1,review:!1,wishes:!1,newProject:!1,showAll:!1},o=document.querySelectorAll(".raiting__label");var e=document.querySelectorAll(".raiting__input");e.forEach((e,a)=>{e.addEventListener("change",()=>{{var r=a;let t=["_current","_gold"];o.forEach(e=>e.classList.remove(...t)),o[r].classList.add("_current");for(let e=0;e<=r;e++)o[e].classList.add("_gold");n.rating=document.querySelector('input[name="raiting"]:checked').value,_()}})});e=document.querySelectorAll(".new-project__input");let a=document.querySelectorAll(".new-project__label"),i=(e.forEach((e,t)=>{e.addEventListener("change",()=>{return e=t,a.forEach(e=>{e.classList.remove("_checked"),e.classList.remove("_error")}),a[e].classList.add("_checked"),n.newProject=document.querySelector('input[name="newProject"]:checked').value,void u(!1);var e})}),document.querySelector('.form__input[name="phone"]')),l=document.querySelector('.form__input[name="reviews"]'),s=document.querySelector('.form__input[name="reviewsBad"]'),c=document.querySelector('.form__input[name="wishes"]'),d=(e,t,r)=>{e=3<e.length;r&&(t.classList.remove(e?"_error":"_complete"),t.classList.add(e?"_complete":"_error")),n.review=e},m=(e,t)=>{e=3<e.length;n.wishes=e,t&&(c.classList.remove(e?"_error":"_complete"),c.classList.add(e?"_complete":"_error"))},u=e=>{let t=!0;for(var r in n)if(!1===n[r])switch(t=!1,r){case"review":d(l.value,l,e),d(s.value,s,e);break;case"wishes":m("",e);break;case"newProject":null===document.querySelector('input[name="newProject"]:checked')&&e&&a.forEach(e=>{e.classList.remove("_checked"),e.classList.add("_error")})}return!0===t?$(".form__btn").addClass("_active"):$(".form__btn").removeClass("_active"),t},_=(i&&i.addEventListener("input",()=>{var e=i.value,t=!0;e=16===e.length,t&&(i.classList.remove(e?"_error":"_complete"),i.classList.add(e?"_complete":"_error")),e?(n.phone=!0,_()):n.phone=!1,u(!1)}),l&&l.addEventListener("change",()=>{d(l.value,l,!0),u(!1)}),s&&s.addEventListener("change",()=>{d(s.value,s,!0),u(!1)}),c&&c.addEventListener("change",()=>{m(c.value,!0),u(!1)}),()=>{var e=$('.form__item-wrap[data-option="bed"]'),t=$('.form__item-wrap[data-option="nice"]');n.phone&&n.rating&&!n.showAll&&(n.showAll=!0,n.ratingOld=n.rating,(3<n.rating?(e.hide(),t):(t.hide(),e)).fadeIn(),animationReviews(),$(".form__item-wrap._end-anim").slideDown(),$(".form__btn").fadeIn(),animationEnd()),n.phone&&n.rating&&n.showAll&&(3<n.ratingOld&&n.rating<=3&&(n.ratingOld=n.rating,t.hide(),e.fadeIn(),animationReviews()),n.ratingOld<=3)&&3<n.rating&&(n.ratingOld=n.rating,e.hide(),t.fadeIn(),animationReviews())});const v="https://script.google.com/macros/s/AKfycby_eeTLAfpp7lELjnJVVXjKdY_7SRgj0iHRg0dTOuiWkiQMrKi3s0Q4XF-3aewsfY8Qww/exec";e=document.querySelector("#form");e.action=v,e.addEventListener("submit",async e=>{if(e.preventDefault(),u(!0)){var t,r={phone:i.value,raiting:n.rating,reviews:l.value,reviewsBad:s.value,wishes:c.value,newProject:n.newProject};let e=[];for(t in r){var a=encodeURIComponent(t),o=encodeURIComponent(r[t]);e.push(a+"="+o)}e=e.join("&"),$(".preloader").fadeIn();await fetch(v,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},mode:"cors",body:e}).then(async e=>{var t,r;console.log(e),$(".preloader").fadeOut(),e.json(),200===e.status&&(console.log("Записано в гугл таблицу"),"yes"===n.newProject&&await h(),3<n.rating?(t=l.value,r=i.value,localStorage.setItem("reviews_ls",t),localStorage.setItem("phone_ls",r)):document.location.href="/thank-two.html"),"error"===e.type&&(alert("Error",e.errors),console.log("Ошибка( "+e.errors))}).catch(e=>console.log("Ошибка!",e))}else alert("Заполните все поля")});let h=async()=>{await $.ajax({type:"POST",url:"mail.php",dataType:"json",data:"2",success:function(e){console.log("Письмо отправлено на почту")},error:function(e,t,r){alert(e.status),alert(r)},complete:function(e){console.log("")}})},t=$(".body"),r=$("#toggle-menu"),g=$("#mobMenu");r.on("click",()=>{r.toggleClass("_active"),t.toggleClass("_fixed"),g.toggleClass("_open")})};