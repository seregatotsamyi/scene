import{animation,animationReviews,animationEnd}from"./anim.js";window.onload=function(){"use strict";animation();let n={phone:!1,rating:!1,ratingOld:!1,review:!1,wishes:!1,newProject:!1,showAll:!1},a=document.querySelectorAll(".raiting__label"),e=document.querySelectorAll(".raiting__input");e.forEach((e,t)=>{e.addEventListener("change",()=>(t=>{let r=["_current","_gold"];a.forEach(e=>e.classList.remove(...r)),a[t].classList.add("_current");for(let e=0;e<=t;e++)a[e].classList.add("_gold");n.rating=document.querySelector('input[name="raiting"]:checked').value,h()})(t))});let t=document.querySelectorAll(".new-project__input"),o=document.querySelectorAll(".new-project__label");t.forEach((e,t)=>{e.addEventListener("change",()=>(e=>{o.forEach(e=>{e.classList.remove("_checked"),e.classList.remove("_error")}),o[e].classList.add("_checked"),n.newProject=document.querySelector('input[name="newProject"]:checked').value,u(!1)})(t))});let l=document.querySelector('.form__input[name="phone"]'),s=document.querySelector('.form__input[name="reviews"]'),i=document.querySelector('.form__input[name="reviewsBad"]'),c=document.querySelector('.form__input[name="wishes"]'),d=(e,t,r)=>{e=3<e.length;r&&(t.classList.remove(e?"_error":"_complete"),t.classList.add(e?"_complete":"_error")),n.review=e},m=(e,t)=>{e=3<e.length;n.wishes=e,t&&(c.classList.remove(e?"_error":"_complete"),c.classList.add(e?"_complete":"_error"))},u=e=>{let t=!0;for(var r in n)if(!1===n[r])switch(t=!1,r){case"review":d(s.value,s,e),d(i.value,i,e);break;case"wishes":m("",e);break;case"newProject":null===document.querySelector('input[name="newProject"]:checked')&&e&&o.forEach(e=>{e.classList.remove("_checked"),e.classList.add("_error")})}return!0===t?$(".form__btn").addClass("_active"):$(".form__btn").removeClass("_active"),t};l&&l.addEventListener("input",()=>{((e,t)=>{e=16===e.length;t&&(l.classList.remove(e?"_error":"_complete"),l.classList.add(e?"_complete":"_error")),e?(n.phone=!0,h()):n.phone=!1})(l.value,!0),u(!1)}),s&&s.addEventListener("change",()=>{d(s.value,s,!0),u(!1)}),i&&i.addEventListener("change",()=>{d(i.value,i,!0),u(!1)}),c&&c.addEventListener("change",()=>{m(c.value,!0),u(!1)});let h=()=>{let e=$('.form__item-wrap[data-option="bed"]'),t=$('.form__item-wrap[data-option="nice"]');n.phone&&n.rating&&!n.showAll&&(n.showAll=!0,n.ratingOld=n.rating,3<n.rating?(e.hide(),t.fadeIn()):(t.hide(),e.fadeIn()),animationReviews(),$(".form__item-wrap._end-anim").slideDown(),$(".form__btn").fadeIn(),animationEnd()),n.phone&&n.rating&&n.showAll&&(3<n.ratingOld&&n.rating<=3&&(n.ratingOld=n.rating,t.hide(),e.fadeIn(),animationReviews()),n.ratingOld<=3&&3<n.rating&&(n.ratingOld=n.rating,e.hide(),t.fadeIn(),animationReviews()))};const _="https://script.google.com/macros/s/AKfycbxHC4gohunY5rmCZ5Z4dNMkA-Pz7LPFTuGYbWrZoYjmIFTmznxHrMryLRJUFNa5DqdZ1w/exec",r=document.querySelector("#form");r&&(r.action=_,r.addEventListener("submit",async e=>{if(e.preventDefault(),u(!0)){var t,r={phone:l.value.replace("+","").replace(/\s/g,""),raiting:n.rating,reviews:s.value,reviewsBad:i.value,wishes:c.value,newProject:n.newProject};let e=[];for(t in r){var a=encodeURIComponent(t),o=encodeURIComponent(r[t]);e.push(a+"="+o)}e=e.join("&"),console.log(e),$(".preloader").fadeIn();await fetch(_,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},mode:"cors",body:e}).then(async e=>{var t,r;console.log(e),$(".preloader").fadeOut(),e.json(),200===e.status&&(console.log("Записано в гугл таблицу"),"yes"===n.newProject&&await p(),3<n.rating?(t=s.value,r=l.value.replace("+","").replace(/\s/g,""),localStorage.setItem("reviews_ls",t),localStorage.setItem("phone_ls",r),document.location.href="/thank.html"):document.location.href="/thank-two.html"),"error"===e.type&&(alert("Error",e.errors),console.log("Ошибка( "+e.errors))}).catch(e=>console.log("Ошибка!",e))}else alert("Заполните все поля")}));let p=async()=>{var e=$("#form").serialize();await $.ajax({url:"mail.php",method:"POST",data:e,dataType:"json",encoding:!0,success:e=>{1==e||alert("Произошла ошибка")},error:function(e,t){0===e.status?alert("Not connect. Verify Network."):404==e.status?alert("Requested page not found (404)."):500==e.status?alert("Internal Server Error (500)."):"parsererror"===t?alert("Requested JSON parse failed."):"timeout"===t?alert("Time out error."):"abort"===t?alert("Ajax request aborted."):alert("Uncaught Error. "+e.responseText)}})},g=$(".body"),v=$("#toggle-menu"),w=$("#mobMenu");v.on("click",()=>{v.toggleClass("_active"),g.toggleClass("_fixed"),w.toggleClass("_open")})};