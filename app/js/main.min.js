import{animation,animationReviews,animationEnd}from"./anim.js";window.onload=function(){"use strict";animation();let s={phone:!1,rating:!1,ratingOld:!1,review:!1,wishes:!1,newProject:!1,showAll:!1},r=document.querySelectorAll(".raiting__label"),e=document.querySelectorAll(".raiting__input");e.forEach((e,t)=>{e.addEventListener("change",()=>(t=>{let a=["_current","_gold"];r.forEach(e=>e.classList.remove(...a)),r[t].classList.add("_current");for(let e=0;e<=t;e++)r[e].classList.add("_gold");s.rating=document.querySelector('input[name="raiting"]:checked').value,u()})(t))});let t=document.querySelectorAll(".new-project__input"),o=document.querySelectorAll(".new-project__label");t.forEach((e,t)=>{e.addEventListener("change",()=>(e=>{o.forEach(e=>{e.classList.remove("_checked"),e.classList.remove("_error")}),o[e].classList.add("_checked"),s.newProject=document.querySelector('input[name="newProject"]:checked').value,_(!1)})(t))});let l=document.querySelector('.form__input[name="phone"]'),c=document.querySelector('.form__input[name="reviews"]'),d=document.querySelector('.form__input[name="reviewsBad"]'),m=document.querySelector('.form__input[name="wishes"]'),n=(e,t,a)=>{3<e.length?(s.review=!0,a&&(t.classList.remove("_error"),t.classList.add("_complete"))):(s.review=!1,a&&(t.classList.add("_error"),t.classList.remove("_complete")))},i=(e,t)=>{3<e.length?(s.wishes=!0,t&&(m.classList.remove("_error"),m.classList.add("_complete"))):(s.wishes=!1,t&&(m.classList.remove("_complete"),m.classList.add("_error")))},_=e=>{let t=!0;for(var a in s)if(!1===s[a])switch(t=!1,a){case"review":n(c.value,c,e),n(d.value,d,e);break;case"wishes":i("",e);break;case"newProject":null===document.querySelector('input[name="newProject"]:checked')&&e&&o.forEach(e=>{e.classList.remove("_checked"),e.classList.add("_error")})}return t?$(".form__btn").addClass("_active"):$(".form__btn").removeClass("_active"),t};l&&l.addEventListener("input",()=>{var e,t;e=l.value,t=!0,16===e.length?(s.phone=!0,t&&(l.classList.remove("_error"),l.classList.add("_complete")),u()):(s.phone=!1,t&&(l.classList.remove("_complete"),l.classList.add("_error"))),_(!1)}),c&&c.addEventListener("change",()=>{n(c.value,c,!0),_(!1)}),d&&d.addEventListener("change",()=>{n(d.value,d,!0),_(!1)}),m&&m.addEventListener("change",()=>{i(m.value,!0),_(!1)});let u=()=>{s.phone&&s.rating&&!s.showAll&&(s.showAll=!0,s.ratingOld=s.rating,3<s.rating?($('.form__item-wrap[data-option="bed"]').hide(),$('.form__item-wrap[data-option="nice"]').fadeIn()):($('.form__item-wrap[data-option="nice"]').hide(),$('.form__item-wrap[data-option="bed"]').fadeIn()),animationReviews(),$(".form__item-wrap._end-anim").slideDown(),$(".form__btn").fadeIn(),animationEnd()),s.phone&&s.rating&&s.showAll&&(3<s.ratingOld&&s.rating<=3&&(s.ratingOld=s.rating,$('.form__item-wrap[data-option="nice"]').hide(),$('.form__item-wrap[data-option="bed"]').fadeIn(),animationReviews()),s.ratingOld<=3&&3<s.rating&&(s.ratingOld=s.rating,$('.form__item-wrap[data-option="bed"]').hide(),$('.form__item-wrap[data-option="nice"]').fadeIn(),animationReviews()))};const p="https://script.google.com/macros/s/AKfycby_eeTLAfpp7lELjnJVVXjKdY_7SRgj0iHRg0dTOuiWkiQMrKi3s0Q4XF-3aewsfY8Qww/exec",a=document.querySelector("#form");a.action=p,a.addEventListener("submit",async t=>{if(t.preventDefault(),_(!0)){var a,r={phone:l.value,raiting:s.rating,reviews:c.value,reviewsBad:d.value,wishes:m.value,newProject:s.newProject};console.log(r);let e=[];for(a in r){var o=encodeURIComponent(a),n=encodeURIComponent(r[a]);e.push(o+"="+n)}e=e.join("&"),console.log(e);var i=await fetch(p,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},mode:"cors",body:e}).then(e=>{e.json(),console.log(e)}).catch(e=>alert("Ошибка!"));"success"===i.type&&alert("Спасибо за заявку!"),"error"===i.type&&alert("Ошибка( "+i.errors),3<s.rating&&(t=c.value,i=l.value,localStorage.setItem("reviews_ls",t),localStorage.setItem("phone_ls",i))}else alert("Валидация")});let v=$(".body"),w=$("#toggle-menu"),h=$("#mobMenu");w.on("click",()=>{w.toggleClass("_active"),v.toggleClass("_fixed"),h.toggleClass("_open")})};